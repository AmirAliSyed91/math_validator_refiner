# FAISS Index Building Script - Usage Guide

## Overview

The `build_faiss_index.py` script creates a persistent FAISS vector index from your `questions.json` file. This dramatically improves server startup time by pre-computing all embeddings.

## Quick Start

```bash
# Navigate to backend directory
cd /Users/macbookpro/Desktop/rag_test2/backend

# Run the script (with virtual environment)
/Users/macbookpro/Desktop/rag_test2/backend/venv/bin/python scripts/build_faiss_index.py
```

## What It Does

1. Reads all questions from `questions.json`
2. Generates embeddings using OpenAI's `text-embedding-3-small` model
3. Creates a FAISS index for fast similarity search
4. Saves everything to `backend/faiss_data/`:
   - `faiss_index.index` - The vector index
   - `embeddings.npy` - Embedding vectors (1536 dimensions)
   - `questions_metadata.json` - All question data
   - `index_info.json` - Index configuration

## Benefits

### Before (Without Pre-built Index)
- Server builds index on startup
- Takes several seconds with API calls to OpenAI
- Rebuilds every time server restarts
- Slow during development

### After (With Pre-built Index)
- Server loads index from disk instantly
- No API calls during startup
- Fast server restarts
- Much better developer experience

## Workflow

### 1. Initial Setup
```bash
# Build the index once
python scripts/build_faiss_index.py
```

### 2. Server Automatically Uses It
```bash
# Start server - it will load the pre-built index
python app/start_server.py
```

You'll see in the logs:
```
Loading pre-built FAISS index from disk...
Loaded index with 10 questions successfully.
```

### 3. When to Rebuild

Run the script again whenever you:
- Add new questions to `questions.json`
- Modify existing questions
- Delete questions
- Change the embedding model

## File Structure

```
backend/
├── questions.json              # Source questions
├── scripts/
│   └── build_faiss_index.py   # This script
└── faiss_data/                 # Generated by script
    ├── faiss_index.index       # Vector index
    ├── embeddings.npy          # Embeddings
    ├── questions_metadata.json # Question data
    └── index_info.json         # Index info
```

## Output Example

```
================================================================================
Building FAISS Index for Mathematical Questions
================================================================================

[1/5] Loading questions from: /path/to/questions.json
      Loaded 10 questions

[2/5] Initializing OpenAI Embeddings model: text-embedding-3-small

[3/5] Extracting question texts

[4/5] Generating embeddings (this may take a moment)...
      Generated embeddings with shape: (10, 1536)

[5/5] Building FAISS index
      Indexed 10 vectors

[SAVE] Writing FAISS index to: /path/to/faiss_data/faiss_index.index
[SAVE] Writing embeddings to: /path/to/faiss_data/embeddings.npy
[SAVE] Writing questions metadata to: /path/to/faiss_data/questions_metadata.json
[SAVE] Writing index info to: /path/to/faiss_data/index_info.json

================================================================================
FAISS Index Build Complete!
================================================================================

Total questions indexed: 10
Embedding dimension: 1536
```

## Troubleshooting

### "OPENAI_API_KEY not found"
- Make sure your `.env` file exists in `backend/` directory
- Verify `OPENAI_API_KEY` is set in `.env`

### "Pre-built index not found"
- This is normal if you haven't run the script yet
- Server will build index from scratch (slower but works)

### Index seems outdated
- Delete `faiss_data/` directory
- Run `python scripts/build_faiss_index.py` again

## Notes

- The `faiss_data/` directory is in `.gitignore` (not committed to git)
- Each developer needs to build their own index locally
- Consider adding this to your setup documentation for new team members

